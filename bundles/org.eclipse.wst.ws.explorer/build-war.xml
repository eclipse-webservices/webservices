<?xml version="1.0" encoding="UTF-8"?>
<project name="org.eclipse.wst.ws.explorer" default="build.wars" basedir=".">
    
    <!-- the environment variables are important to set here, and 
    to have JAVA_4_HOME set to some Java 1.4 SDK home, 
    since we want this compiled with a 1.4 version, but 
    this overall build itself might be being ran in Java 1.5 -->
    <property environment="env" />
    
	<property name="wsexplorerDir" value="${buildDirectory}/plugins/org.eclipse.wst.ws.explorer/wsexplorer"/>

	<target name="jspcompile" unless="wsexplorer.war" description="Pre-compile the JSPs in the org.eclipse.wst.ws.explorer plugin">
		<java classname="org.apache.jasper.JspC" fork="true" jvm="${env.JAVA_4_HOME}/bin/java">
			<arg line="-webxml ${wsexplorerDir}/WEB-INF/web.xml -d ${wsexplorerDir} -webapp ${wsexplorerDir}"/>
			<classpath>
				<fileset dir="${baseLocation}/plugins">
					<include name="org.eclipse.tomcat*/*.jar" />
				</fileset>
				<fileset dir="${baseLocation}/plugins">
					<include name="org.apache.ant*/lib/*.jar" />
				</fileset>
			</classpath>
		</java>
		<javac destdir="${wsexplorerDir}/WEB-INF/classes" includeAntRuntime="false" failonerror="false" executable="${env.JAVA_4_HOME}/bin/javac" fork="true">
			<src path="${wsexplorerDir}"/>
			<classpath>
				<fileset dir="${buildDirectory}/plugins">
					<include name="**/*.jar" />
				</fileset>
				<fileset dir="${buildDirectory}/plugins">
					<include name="*.jar" />
				</fileset>
				<dirset dir="${buildDirectory}/plugins">
					<include name="**/@dot"/>
				</dirset>
				<fileset dir="${baseLocation}/plugins">
					<include name="**/*.jar" />
				</fileset>
				<fileset dir="${baseLocation}/plugins">
					<include name="*.jar" />
				</fileset>
			</classpath>
		</javac>
	</target>

	<target name="wsexplorer.war" unless="wsexplorer.war" description="Create war: wsexplorer.war.">
		<zip
			basedir="${wsexplorerDir}"
			destfile="${wsexplorerDir}/../wsexplorer.war"
			whenempty="skip" update="false"
			excludes="**/*.java **/*.jsp **/*.inc"
		/>
	</target>	
	
	<target name="build.wars" description="Build all the wars for the plug-in: org.eclipse.wst.ws.explorer.">
		<available property="wsexplorer.war" file="${wsexplorerDir}/../wsexplorer.war"/>
		<antcall target="jspcompile"/>
		<antcall target="wsexplorer.war"/>
	</target>

	<target name="clean.wars" description="Clean all the wars for the plug-in: org.eclipse.wst.ws.explorer.">
		<delete file="wsexplorer.war"/>
	</target>

</project>
